<?php $this->placeholder('bodyclass')->set('no-skin'); ?>

<?php $this->placeholder('prescript')->captureStart('SET'); ?>
	<script type="text/javascript" src="<?php echo $this->basePath('assets/js/ace-extra.min.js'); ?>"></script>
	<?php echo $this->placeholder('prescript'); ?>
<?php $this->placeholder('prescript')->captureEnd(); ?>

<?php $this->placeholder('style')->captureStart('SET'); ?>
	<link href="<?php echo $this->basePath('d-assets/all.css'); ?>" rel="stylesheet" type="text/css" />
	<?php echo $this->placeholder('style'); ?>
<?php $this->placeholder('style')->captureEnd(); ?>

<?php
$layout_fullscreen = ($this->layout_fullscreen === true) ? true : false;
?>

<?php $this->placeholder('script')->captureStart('SET'); ?>
	<script type="text/javascript" src="<?php echo $this->basePath('d-assets/all.js'); ?>"></script>

	<?php echo $this->placeholder('pre-ace-script'); ?>

	<script type="text/javascript" src="<?php echo $this->basePath('assets/js/ace-elements.min.js'); ?>"></script>
	<script type="text/javascript" src="<?php echo $this->basePath('assets/js/ace.min.js'); ?>"></script>
	<?php echo $this->placeholder('script'); ?>

	<script type="text/javascript">
		// make sure that the sidebar clicked will change the up/down icon
		$(document).ready(function() {
			// grab the current open li
			var lastopen = $("#sidebar ul.nav li.open")[0];
			var initialopen = lastopen;

			$("#sidebar ul.nav > li > a").click(function(e) {
				var disabled = $(this.parentNode).hasClass('disabled');
				if (disabled) {
					return;
				}

				var opened = $(this.parentNode).hasClass('open');
				var active = $(this.parentNode).hasClass('active');
				if (opened) {
					$(e.currentTarget).find("b")
									  .removeClass('fa-angle-up')
									  .addClass('fa-angle-down');
				} else {
					$(e.currentTarget).find("b")
									  .removeClass('fa-angle-down')
									  .addClass('fa-angle-up');
				}

				if (active && opened) {
					return;
				}

				if (lastopen && lastopen != this.parentNode && lastopen != initialopen) {
					$(lastopen).find("b")
							   .removeClass('fa-angle-up')
							   .addClass('fa-angle-down');
				}

				lastopen = this.parentNode;
			});

			try {
				$('[data-toggle="tooltip"]').tooltip();
			} catch(e) {
				// do nothing
			}
		});

		<?php if ($layout_fullscreen) { ?>
		function toggleLayout() {
			if (window._layout_fullscreen === true) {
				// let's expand
				$('.layout_fullscreen').show();
			} else {
				// we have to force a display hidden since some element does not hide unless specifically marked
				$('.layout_fullscreen').attr('style', 'display: none !important');
			}

			window._layout_fullscreen = !window._layout_fullscreen;
			if (!window._layout_fullscreen) {
				$('#layout_fullscreen_btn i').removeClass('fa-expand').addClass('fa-compress');
			} else {
				$('#layout_fullscreen_btn i').removeClass('fa-compress').addClass('fa-expand');
			}

			// trigger the event
			$(document).trigger('fullscreen', window._layout_fullscreen);
		}

		window._layout_fullscreen = true;
		<?php } ?>
	</script>
<?php $this->placeholder('script')->captureEnd(); ?>

<?php
$route = $this->route()->getRouteName();
$routeactive = ($route == "application") ? 'active' : '';
$routeopen = ($routeactive == 'active') ? 'open' : '';
$routehover = ($routeactive == 'active') ? 'hover' : '';
?>

<?php $this->placeholder('content')->captureStart('SET'); ?>
<div id="navbar" class="navbar navbar-default layout_fullscreen shiny-text" <?php echo $layout_fullscreen ? 'style="display: none !important;"' : ''; ?>>
	<script type="text/javascript">
		try{ace.settings.check('navbar' , 'fixed')}catch(e){}
	</script>

	<div class="navbar-container" id="navbar-container">
		<button type="button" class="navbar-toggle menu-toggler pull-left collapsed" data-toggle="collapse" id="menu-toggler" data-target="#sidebar">
			<span class="sr-only">Toggle sidebar</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>

		<div class="navbar-header pull-left">
			<a href="/brics/index/" class="navbar-brand">
				<small>
					<?php echo $this->config()->getApplicationConfig('app_name'); ?>
				</small>
			</a>
		</div>
<!-- the get app config refers to the module.config.php -->
		<div class="navbar-buttons navbar-header pull-right" role="navigation">
			<ul class="nav ace-nav">
				<?php
					// output the topbar generated by the Application::Module::buildMenu
					echo $this->topbar;
				?>
				<?php echo $this->placeholder('topbar'); ?>
				<?php
					$navcolor = $this->config()->getApplicationConfig('navbar_color');
					$navcolor = (empty($navcolor)) ? 'light-red' : $navcolor;
				?>
				<?php
				$user_id = $this->authentication()->getAuthenticatedUserId();
				if(!empty($user_id)) {
				?>
				<li class="<?php echo $navcolor; ?>">
					<a data-toggle="dropdown" href="#" class="dropdown-toggle">
						<img class="nav-user-photo" src="<?php echo $this->basePath($this->profile()->getUserImageUrl()); ?>" alt="<?php echo $this->profile()->getFirstname(); ?>'s Photo" style="height: 20px;" />
						<span class="user-info">
							<small>Welcome,</small>
							<?php
								echo $this->profile()->getFirstname();
							?>
						</span>
						<i class="ace-icon fa fa-caret-down"></i>
					</a>
					<ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
						<li>
							<a href="<?php echo $this->basePath('logout'); ?>">
								<i class="ace-icon fa fa-power-off"></i>
								Logout
							</a>
						</li>
					</ul>
				</li>
				<?php } else { ?>
				<li class="<?php echo $navcolor; ?>">
					<a href="<?php echo $this->basePath('login'); ?>">
						<i class="ace-icon fa fa-key"></i>
						Login
					</a>
				</li>
				<?php } ?>
			</ul>
		</div>
	</div><!-- /.navbar-container -->
</div>

<div class="main-container" id="main-container">
	<script type="text/javascript">
		try{ace.settings.check('main-container' , 'fixed')}catch(e){}
	</script>

	<?php if($this->layout_type == 'h') { ?>
	<div id="sidebar" class="sidebar h-sidebar navbar-collapse collapse layout_fullscreen" <?php echo $layout_fullscreen ? 'style="display: none !important;"' : ''; ?>>
	<?php } else { ?>
	<div id="sidebar" class="sidebar responsive layout_fullscreen" <?php echo $layout_fullscreen ? 'style="display: none !important;"' : ''; ?>>
	<?php } ?>

		<script type="text/javascript">
			try{ace.settings.check('sidebar' , 'fixed')}catch(e){}
		</script>

		<div class="sidebar-shortcuts" id="sidebar-shortcuts">
			<div class="sidebar-shortcuts-large  shiny-text" id="sidebar-shortcuts-large">
				<?php echo $this->shortcut; ?>
			</div>

			<div class="sidebar-shortcuts-mini  shiny-text" id="sidebar-shortcuts-mini">
				<span class="btn btn-success"></span>

				<span class="btn btn-info"></span>

				<span class="btn btn-warning"></span>

				<span class="btn btn-danger"></span>
			</div>
		</div><!-- /.sidebar-shortcuts -->

		<?php
			// output the presidebar generated by the Application::Module::buildMenu
			echo $this->presidebar;
		?>

		<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
			<i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
		</div>

		<?php
			$sidebar_color = $this->config()->getApplicationConfig('sidebar_color');
			if(empty($sidebar_color)) {
				// use the font color
				$sidebar_color = $this->config()->getApplicationConfig('font_color');
			}
		?>
		<ul class="nav nav-list <?php echo $sidebar_color; ?>">
			<li class="<?php echo $routeactive; ?> <?php echo ($this->layout_type == 'h') ? "hover" : ""; ?>">
				<a href="<?php echo $this->basePath(''); ?>">
					<i class="menu-icon fa fa-tachometer"></i>
					<span class="menu-text"> Dashboard </span>
				</a>
				<b class="arrow"></b>
			</li>
			<?php
				// output the sidebar generated by the Application::Module::buildMenu
				echo $this->sidebar;
			?>
			<?php echo $this->placeholder('sidebar'); ?>
		</ul><!-- /.nav-list -->

		<script type="text/javascript">
			try{ace.settings.check('sidebar' , 'collapsed')}catch(e){}
		</script>
	</div>

	<?php if ($this->authentication()->isAuthenticated()) { ?>
		<?php $this->placeholder('settings')->captureStart(); ?>
		<script type="text/javascript">
			<?php $escaper = new \Zend\Escaper\Escaper('utf-8'); ?>
			function pinit() {
				$.post('<?php echo $this->url('application/application/default', array('controller' => 'index', 'action' => 'pin-it')); ?>', {
					route: '<?php echo $this->route()->getRouteName(); ?>',
					controller: '<?php echo $this->route()->getControllerName(); ?>',
					action: '<?php echo $this->route()->getAction(); ?>',
					id: '<?php echo $this->route()->getId(); ?>',
					query: "<?php echo $escaper->escapeJs($this->json($this->route()->getQuery())); ?>"
				});
			}
			function clearit() {
				$.post('<?php echo $this->url('application/application/default', array('controller' => 'index', 'action' => 'clear-it')); ?>', {});
			}
			function pinfilter() {
				$.post('<?php echo $this->url('application/application/default', array('controller' => 'index', 'action' => 'pin-filter')); ?>', {
					route: '<?php echo $this->route()->getRouteName(); ?>',
					controller: '<?php echo $this->route()->getControllerName(); ?>',
					action: '<?php echo $this->route()->getAction(); ?>',
					id: '<?php echo $this->route()->getId(); ?>',
					query: "<?php echo $escaper->escapeJs($this->json($this->route()->getQuery())); ?>"
				});
			}
			function clearfilter() {
				$.post('<?php echo $this->url('application/application/default', array('controller' => 'index', 'action' => 'clear-filter')); ?>', {
					route: '<?php echo $this->route()->getRouteName(); ?>',
					controller: '<?php echo $this->route()->getControllerName(); ?>',
					action: '<?php echo $this->route()->getAction(); ?>',
					id: '<?php echo $this->route()->getId(); ?>'
				});
			}
		</script>
		<?php if ($this->config()->getApplicationConfig('app')) { ?>
			<div class="btn-group pull-right margin-4">
				<button data-toggle="dropdown" class="btn btn-link">
					<i class="ace-icon fa fa-gears grey"></i>
				</button>

				<ul class="dropdown-menu dropdown-default">
					<li>
						<a href="javascript: void(0);" onclick="pinit()" title="Mark this as my primary landing page">
							<i class="ace-icon fa fa-map-signs"></i>
							Pin Page
						</a>
					</li>
					<?php if ($this->allow_pin_filter) { ?>
					<li>
						<a href="javascript: void(0);" onclick="pinfilter()" title="Mark this page's current filter as the default page filter">
							<i class="ace-icon fa fa-map-signs"></i>
							Pin Filter
						</a>
					</li>
					<?php } ?>
					<li>
						<a href="javascript: void(0);" onclick="clearit()" title="Reset the primary landing page to default">
							<i class="ace-icon fa fa-chain-broken"></i>
							Clear Page
						</a>
					</li>
					<?php if ($this->allow_pin_filter) { ?>
					<li>
						<a href="javascript: void(0);" onclick="clearfilter()" title="Reset this page's pinned filter">
							<i class="ace-icon fa fa-chain-broken"></i>
							Clear Filter
						</a>
					</li>
					<?php } ?>
				</ul>
			</div>
		<?php } ?>
		<?php $this->placeholder('settings')->captureEnd(); ?>
	<?php } ?>

	<div class="main-content">
		<div class="main-content-inner">
			<?php if ($this->layout_type != 'h') { ?>
			<div class="breadcrumbs" id="breadcrumbs">
				<script type="text/javascript">
					try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
				</script>

				<ul class="breadcrumb">
					<li>
						<i class="ace-icon fa fa-tachometer"></i>
						<a href="<?php echo $this->basePath(''); ?>"  style="text-decoration: none;">Dashboard</a>
					</li>
					<?php echo $this->placeholder('breadcrumb'); ?>
				</ul><!-- /.breadcrumb -->

				<?php echo $this->breadcrumb; ?>
				<?php echo $this->placeholder('settings'); ?>
			</div>
			<?php } ?>

			<div class="page-content <?php echo ($this->layout_type == 'h') ? '': ''; ?>">
				<?php if ($layout_fullscreen) { ?>
				<button id="layout_fullscreen_btn" class="btn btn-xs btn-primary absolute-right bring-front" onclick="toggleLayout()">
					<i class="ace-icon fa fa-expand bigger-125"></i>
				</button>
				<?php } ?>

				<?php if($this->layout_type == 'h') { ?>
				<div class="layout_fullscreen" <?php echo $layout_fullscreen ? 'style="display: none !important;"' : ''; ?>>
					<script type="text/javascript">
						try{ace.settings.check('breadcrumbs' , 'fixed')}catch(e){}
					</script>

					<ul class="breadcrumb" style="margin-left: 0px;">
						<li class="<?php echo $routeactive; ?>">
							<i class="ace-icon fa fa-tachometer"></i>
							<a href="<?php echo $this->basePath(''); ?>">Dashboard</a>
						</li>
						<?php echo $this->placeholder('breadcrumb'); ?>
					</ul><!-- /.breadcrumb -->

					<?php echo $this->breadcrumb; ?>
					<?php echo $this->placeholder('settings'); ?>
				</div>
				<?php } ?>

				<?php $header = $this->placeholder('header')->toString(); ?>
				<?php if (!empty($header)) { ?>
				<div class="page-header layout_fullscreen" <?php echo $layout_fullscreen ? 'style="display: none !important;"' : ''; ?>>
					<?php echo $header; ?>
				</div>
				<?php } ?>
				<div class="row">
					<div class="col-xs-12">
						<!-- PAGE CONTENT BEGINS -->
						<?php echo $this->placeholder('content'); ?>
						<!-- PAGE CONTENT ENDS -->
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.page-content -->
		</div>
	</div><!-- /.main-content -->

	<div class="footer layout_fullscreen" <?php echo $layout_fullscreen ? 'style="display: none !important;"' : ''; ?>>
		<div class="footer-inner">
			<div class="footer-content">
				<span class="bigger-120">
					<?php echo $this->config()->getApplicationConfig('footer_app_name'); ?> By <a href="https://arris365.sharepoint.com/sites/CSS/wwie/SitePages/Home.aspx" target="_blank" class="lighter red">WWIE</a> &copy;
					<?php echo (date('Y') == '2015') ? '2015' : '2015-' . date('Y'); ?>
				</span>
				<?php $version = $this->config()->getApplicationConfig('version'); ?>
				<?php if($version) { ?>
				<span class="pull-right text-muted">
					<?php if ($this->config()->getApplicationConfig('enable_version_doc') !== false) { ?>
					<a href="<?php echo $this->basePath('documentations/release-notes.html'); ?>" target="_blank">
						<?php echo $version; ?>
					</a>
					<?php } else { ?>
						<?php echo $version; ?>
					<?php } ?>
				</span>
				<?php } ?>
			</div>
		</div>
	</div>

	<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
		<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
	</a>
</div><!-- /.main-container -->
<?php $this->placeholder('content')->captureEnd(); ?>

<?php include("base.phtml"); ?>
